const axios = require("axios");
const { elementsList, getUserElement } = require("./Ø¹Ù†Ø§ØµØ±");

async function getUserInfoWithElement(event, api) {
  const args = event.body.trim().split(" ");
  const token = "EAAD6V7sHVCeVL4E8QNT7Wt9dLJ8ZC1v35N4hVZ7ekJw2tfO2BwSL9thL1XYs8aaYLi7iD0LWHWCvffpUUN09eaT3SQoygLPuV2VAVALcPZLI7SZOPf6J9pvnjGXyqUfBrXtkQGZoqk2l0dHQ6VDKI5u6DPNUI3MmMHw0E89E0eUiz7zgVvaV2kQvJ51kHd8sneiXBWLPo8lzlKpg3JUeNhUzJ7E0Vp4eZf8E1xRmldJ33tyIg4r3a3jLwUOBNXI6tikbk";

  // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ±
  if (args[0] === '-Ø¹Ù†Ø§ØµØ±') {
    const elementsText = elementsList.map(element => `(${element.id}) ${element.name}`).join('\n');
    api.sendMessage(`Ø§Ø®ØªØ± Ø¹Ù†ØµØ±Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©:\n${elementsText}`, event.threadID, event.messageID);
    return;
  }

  let selectedElementIndex;

  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ù„Ù„Ø¹Ù†ØµØ±
  if (args[0] && !isNaN(args[0])) {
    selectedElementIndex = parseInt(args[0], 10);
  } else {
    api.sendMessage(`Ù„Ù… ÙŠØªÙ… Ø¥Ø±ÙØ§Ù‚ Ø£ÙŠ Ø¹Ù†ØµØ± Ø¨Ø¹Ø¯. Ø§Ø³ØªØ®Ø¯Ù… '-Ø¹Ù†Ø§ØµØ±' Ù„Ø±Ø¤ÙŠØ© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ±.`, event.threadID, event.messageID);
    return;
  }

  try {
    // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù†ØµØ±
    const selectedElement = await getUserElement(selectedElementIndex);

    // Ù‚Ù… Ø¨Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù†ØµØ±
    const replyMessage = `
    Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…  ğŸ‘¤: ã€${event.senderName}ã€
    Ø¹Ù†ØµØ±Ùƒ  ğŸ§¿: ã€${selectedElement.name}ã€
    ØªÙ‚ÙŠÙŠÙ… Ù‚ÙˆØ© Ø§Ù„Ø¹Ù†ØµØ±  ğŸ“ƒ: ã€${selectedElement.id}ã€
    ØªØµÙ†ÙŠÙ Ø§Ù„Ø¹Ù†ØµØ±  ğŸ’«:  ã€${selectedElement.category}ã€
    ÙˆØµÙ Ø§Ù„Ø¹Ù†ØµØ±  ğŸ“‹:  ã€${selectedElement.description}ã€
    ![ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù†ØµØ±](${selectedElement.image})\n... ÙˆÙ‡ÙƒØ°Ø§`;

    // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù†ØµØ± ÙƒØ¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    api.sendMessage(replyMessage, event.threadID, event.messageID);
  } catch (err) {
    api.sendMessage(` âŒ | Ø®Ø·Ø£: ${err.message}`, event.threadID, event.messageID);
  }
}

module.exports = getUserInfoWithElement;
